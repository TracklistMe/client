"use strict";angular.module("tracklistmeApp",["ngAnimate","ui.router","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","satellizer","mgcrea.ngStrap","angularFileUpload"]).config(["$stateProvider","$urlRouterProvider","$authProvider",function(a,b,c){a.state("main",{url:"/",templateUrl:"views/main.html"}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginCtrl"}).state("signup",{url:"/signup",templateUrl:"views/signup.html",controller:"SignupCtrl"}).state("logout",{url:"/logout",template:null,controller:"LogoutCtrl"}).state("noPermission",{url:"/noPermission",templateUrl:"views/nopermission.html",controller:null}).state("profile",{url:"/profile",templateUrl:"views/profile.html",controller:"ProfileCtrl",resolve:{authenticated:["$location","$auth",function(a,b){return b.isAuthenticated()?void 0:a.path("/login")}]}}).state("adminCompanies",{url:"/adminCompanies",templateUrl:"views/adminCompanies.html",controller:"AdmincompaniesCtrl",resolve:{authenticated:["$location","$auth","Account",function(a,b,c){return console.log("TRY AUTENTICATION FOR ADMINCOMPANIES"),b.isAuthenticated()?(console.log("YOU ARE AUTENTICATED"),c.getProfile().success(function(b){return console.log("FETCH DATA FROM ACCOUNT"),b.isAdmin?void 0:a.path("/noPermission")})):(console.log("YOU are not authenticated"),a.path("/login"))}]}}).state("adminCompany",{url:"/adminCompany/{id:int}",templateUrl:"views/admincompany.html",controller:"AdmincompanyCtrl",resolve:{authenticated:["$location","$auth","Account",function(a,b,c){return console.log("TRY AUTENTICATION FOR ADMINCOMPANIES"),b.isAuthenticated()?(console.log("YOU ARE AUTENTICATED"),c.getProfile().success(function(b){return console.log("FETCH DATA FROM ACCOUNT"),b.isAdmin?void 0:a.path("/noPermission")})):(console.log("YOU are not authenticated"),a.path("/login"))}]}}).state("adminLabel",{url:"/adminLabel/{id:int}",templateUrl:"views/adminLabel.html",controller:"AdminlabelCtrl",resolve:{authenticated:["$location","$auth","Account",function(a,b,c){return console.log("TRY AUTENTICATION FOR ADMINCOMPANIES"),b.isAuthenticated()?(console.log("YOU ARE AUTENTICATED"),c.getProfile().success(function(b){return console.log("FETCH DATA FROM ACCOUNT"),b.isAdmin?void 0:a.path("/noPermission")})):(console.log("YOU are not authenticated"),a.path("/login"))}]}}).state("adminLabels",{url:"/adminLabels",templateUrl:"views/adminLabels.html",controller:"AdminlabelsCtrl",resolve:{authenticated:["$location","$auth","Account",function(a,b,c){return console.log("TRY AUTENTICATION FOR ADMINCOMPANIES"),b.isAuthenticated()?(console.log("YOU ARE AUTENTICATED"),c.getProfile().success(function(b){return console.log("FETCH DATA FROM ACCOUNT"),b.isAdmin?void 0:a.path("/noPermission")})):(console.log("YOU are not authenticated"),a.path("/login"))}]}}),b.otherwise("/"),c.loginUrl="http://localhost:3000/auth/login",c.signupUrl="http://localhost:3000/auth/signup",c.facebook({clientId:"1377656882510514"}),c.github({clientId:"0ba2600b1dbdb756688b"}),c.linkedin({clientId:"77cw786yignpzj"}),c.yahoo({clientId:"dj0yJmk9SDVkM2RhNWJSc2ZBJmQ9WVdrOWIzVlFRMWxzTXpZbWNHbzlNQS0tJnM9Y29uc3VtZXJzZWNyZXQmeD0yYw--"}),c.twitter({url:"http://localhost:3000/auth/twitter",type:"1.0",popupOptions:{width:495,height:645}}),c.live({clientId:"000000004C12E68D"}),c.oauth2({name:"foursquare",url:"/auth/foursquare",clientId:"MTCEJ3NGW2PNNB31WOSBFDSAD4MTHYVAZ1UKIULXZ2CVFC2K",redirectUri:window.location.origin||window.location.protocol+"//"+window.location.host,authorizationEndpoint:"https://foursquare.com/oauth2/authenticate"})}]),angular.module("tracklistmeApp").controller("MainCtrl",["$scope",function(a){}]),angular.module("tracklistmeApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("tracklistmeApp").controller("AdminCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("tracklistmeApp").controller("AdmincompaniesCtrl",["$scope","$http",function(a,b){var c=2;a.currentCompany=null,a.isSearching=!1,a.nameAvailable=!1,a.nameTooShort=!0,a.searchUserResults=null,a.companyList={},a.searchCompaniesAvailability=function(){a.searchCompanyField.length>c?(a.isSearching=!0,a.nameTooShort=!1,b.get("http://localhost:3000/companies/search/"+a.searchCompanyField).success(function(b){a.isSearching=!1,a.nameAvailable=b?!1:!0})):a.nameTooShort=!0},a.addCompany=function(){console.log("ADD COMPANY"),b.post("http://localhost:3000/companies/",{companyName:a.searchCompanyField}).success(function(){a.updateCompanyList()}).error(function(){})},a.searchUser=function(){a.searchUserField.length>c&&b.get("http://localhost:3000/users/search/"+a.searchUserField).success(function(b){a.searchUserResults=b,console.log(a.searchUserResults)})},a.selectFromMultipleUsers=function(b){a.searchUserResults=[b],console.log(a.searchUserResults)},a.addUserCompanyAssociation=function(){var c=a.searchUserResults[0].id,d=a.currentCompany.id;console.log(c),b.post("http://localhost:3000/companies/"+d+"/owners/",{newOwner:c}).success(function(){a.editCompany(d)}).error(function(){})},a.removeOwner=function(c){var d=a.currentCompany.id;b["delete"]("http://localhost:3000/companies/"+d+"/owners/"+c).success(function(){a.editCompany(d)}).error(function(){})},a.activateCompany=function(c){console.log("ACTIVATE"),b.put("http://localhost:3000/companies/"+c,{isActive:!0}).success(function(){a.updateCompanyList()}).error(function(){})},a.deactivateCompany=function(c){b.put("http://localhost:3000/companies/"+c,{isActive:!1}).success(function(){a.updateCompanyList()}).error(function(){})},a.editCompany=function(c){b.get("http://localhost:3000/companies/"+c).success(function(b){console.log(b),a.currentCompany=b})},a.updateCompanyList=function(){b.get("http://localhost:3000/companies/").success(function(b){console.log(b),a.companyList=b})},a.updateCompanyList()}]),angular.module("tracklistmeApp").directive("passwordStrength",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e=b.children(),f=Array.prototype.slice.call(e.children()),g=f.slice(-1)[0],h=f.slice(-2),i=f.slice(-3),j=f.slice(-4);b.after(e),b.bind("keyup",function(){var a,b={positive:{},negative:{}},c={positive:{},negative:{}},e=0;angular.forEach(f,function(a){a.style.backgroundColor="#ebeef1"}),d.$viewValue&&(b.positive.lower=d.$viewValue.match(/[a-z]/g),b.positive.upper=d.$viewValue.match(/[A-Z]/g),b.positive.numbers=d.$viewValue.match(/\d/g),b.positive.symbols=d.$viewValue.match(/[$-/:-?{-~!^_`\[\]]/g),b.positive.middleNumber=d.$viewValue.slice(1,-1).match(/\d/g),b.positive.middleSymbol=d.$viewValue.slice(1,-1).match(/[$-/:-?{-~!^_`\[\]]/g),c.positive.lower=b.positive.lower?b.positive.lower.length:0,c.positive.upper=b.positive.upper?b.positive.upper.length:0,c.positive.numbers=b.positive.numbers?b.positive.numbers.length:0,c.positive.symbols=b.positive.symbols?b.positive.symbols.length:0,c.positive.numChars=d.$viewValue.length,a+=c.positive.numChars>=8?1:0,c.positive.requirements=a>=3?a:0,c.positive.middleNumber=b.positive.middleNumber?b.positive.middleNumber.length:0,c.positive.middleSymbol=b.positive.middleSymbol?b.positive.middleSymbol.length:0,b.negative.consecLower=d.$viewValue.match(/(?=([a-z]{2}))/g),b.negative.consecUpper=d.$viewValue.match(/(?=([A-Z]{2}))/g),b.negative.consecNumbers=d.$viewValue.match(/(?=(\d{2}))/g),b.negative.onlyNumbers=d.$viewValue.match(/^[0-9]*$/g),b.negative.onlyLetters=d.$viewValue.match(/^([a-z]|[A-Z])*$/g),c.negative.consecLower=b.negative.consecLower?b.negative.consecLower.length:0,c.negative.consecUpper=b.negative.consecUpper?b.negative.consecUpper.length:0,c.negative.consecNumbers=b.negative.consecNumbers?b.negative.consecNumbers.length:0,e+=4*c.positive.numChars,c.positive.upper&&(e+=2*(c.positive.numChars-c.positive.upper)),c.positive.lower&&(e+=2*(c.positive.numChars-c.positive.lower)),(c.positive.upper||c.positive.lower)&&(e+=4*c.positive.numbers),e+=6*c.positive.symbols,e+=2*(c.positive.middleSymbol+c.positive.middleNumber),e+=2*c.positive.requirements,e-=2*c.negative.consecLower,e-=2*c.negative.consecUpper,e-=2*c.negative.consecNumbers,b.negative.onlyNumbers&&(e-=c.positive.numChars),b.negative.onlyLetters&&(e-=c.positive.numChars),e=Math.max(0,Math.min(100,Math.round(e))),e>85?angular.forEach(j,function(a){a.style.backgroundColor="#008cdd"}):e>65?angular.forEach(i,function(a){a.style.backgroundColor="#6ead09"}):e>30?angular.forEach(h,function(a){a.style.backgroundColor="#e09115"}):g.style.backgroundColor="#e01414")})},template:'<span class="password-strength-indicator"><span></span><span></span><span></span><span></span></span>'}}),angular.module("tracklistmeApp").controller("NavbarCtrl",["$scope","$auth","Account",function(a,b,c){a.showAccountDropDown=!1,a.isAuthenticated=function(){return b.isAuthenticated()},c.getProfile().success(function(b){console.log(b),a.user=b})}]),angular.module("tracklistmeApp").controller("SignupCtrl",["$scope","$alert","$auth",function(a,b,c){a.signup=function(){c.signup({displayName:a.displayName,email:a.email,password:a.password})["catch"](function(a){b({content:a.data.message,animation:"fadeZoomFadeDown",type:"material",duration:3})})}}]),angular.module("tracklistmeApp").controller("LoginCtrl",["$scope","$alert","$auth",function(a,b,c){a.login=function(){c.login({email:a.email,password:a.password}).then(function(){b({content:"You have successfully logged in",animation:"fadeZoom",type:"material",duration:3})})["catch"](function(a){b({content:a.data.message,animation:"fadeZoom",type:"material",duration:3})})},a.authenticate=function(a){console.log("TENTATIVO DI AUTENTICAZIONE CON "+a),c.authenticate(a).then(function(){console.log("AUTENTICATO UFFICIALMENTE"),b({content:"You have successfully logged in",animation:"fadeZoom",type:"material",duration:3})})["catch"](function(a){console.log(a),b({content:a.data.message,animation:"fadeZoom",type:"material",duration:3})})}}]),angular.module("tracklistmeApp").controller("LogoutCtrl",["$auth","$alert",function(a,b){a.isAuthenticated()&&a.logout().then(function(){b({content:"You have been logged out",animation:"fadeZoomFadeDown",type:"material",duration:3})})}]),angular.module("tracklistmeApp").controller("ProfileCtrl",["$scope","$http","$timeout","$auth","$alert","Account","FileUploader",function(a,b,c,d,e,f,g){a.labels={},a.companies={};var h=a.uploader=new g({url:"http://localhost:3000/upload/profilePicture/500/500",method:"POST",headers:{Authorization:"Bearer "+d.getToken()},formData:[]});h.onBeforeUploadItem=function(a){a.formData.push({resize:{width:500,height:500}})},h.onWhenAddingFileFailed=function(a,b,c){console.info("onWhenAddingFileFailed",a,b,c)},h.onAfterAddingFile=function(a){console.info("onAfterAddingFile",a),h.queue[0].upload(),h.queue.pop()},h.onAfterAddingAll=function(a){console.info("onAfterAddingAll",a)},h.onProgressItem=function(a,b){console.info("onProgressItem",a,b)},h.onProgressAll=function(a){console.info("onProgressAll",a)},h.onSuccessItem=function(a,b,c,d){console.info("onSuccessItem",a,b,c,d)},h.onErrorItem=function(a,b,c,d){console.info("onErrorItem",a,b,c,d)},h.onCancelItem=function(a,b,c,d){console.info("onCancelItem",a,b,c,d)},h.onCompleteItem=function(a,b,c,d){console.info("onCompleteItem",a,b,c,d)},h.onCompleteAll=function(){console.info("onCompleteAll"),a.getProfile()},a.getProfile=function(){f.getProfile().success(function(b){a.user=b,console.log(b)}).error(function(a){e({content:a.message,animation:"fadeZoomFadeDown",type:"material",duration:3})})},a.updateProfile=function(){f.updateProfile({displayName:a.user.displayName,email:a.user.email}).then(function(){e({content:"Profile has been updated",animation:"fadeZoomFadeDown",type:"material",duration:3})})},a.link=function(b){d.link(b).then(function(){e({content:"You have successfully linked "+b+" account",animation:"fadeZoomFadeDown",type:"material",duration:3})}).then(function(){a.getProfile()})["catch"](function(a){e({content:a.data.message,animation:"fadeZoomFadeDown",type:"material",duration:3})})},a.unlink=function(b){d.unlink(b).then(function(){e({content:"You have successfully unlinked "+b+" account",animation:"fadeZoomFadeDown",type:"material",duration:3})}).then(function(){a.getProfile()})["catch"](function(a){e({content:a.data?a.data.message:"Could not unlink "+b+" account",animation:"fadeZoomFadeDown",type:"material",duration:3})})},a.getCompanies=function(){b.get("http://localhost:3000/me/companies/").success(function(b){a.companies=b})},a.getLabels=function(){b.get("http://localhost:3000/me/labels/").success(function(b){a.labels=b})},a.getProfile(),a.getLabels(),a.getCompanies()}]),angular.module("tracklistmeApp").factory("Account",["$http","$auth",function(a){return{getProfile:function(){return a.get("http://localhost:3000/me")},updateProfile:function(b){return a.put("http://localhost:3000/me",b)}}}]),angular.module("tracklistmeApp").controller("AdminlabelsCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("tracklistmeApp").controller("AdminlabelCtrl",["$scope","$state","$auth","$stateParams","$http","Account","FileUploader",function(a,b,c,d,e,f,g){var h=d.id;a.label=null,a.dropZoneFiles=null;var i=a.uploader=new g({url:"http://localhost:3000/labels/"+h+"/profilePicture/500/500/",headers:{Authorization:"Bearer "+c.getToken()},data:{user:a.user}});i.onAfterAddingFile=function(a){console.info("onAfterAddingFile",a),i.queue[0].upload(),i.queue.pop()},i.onCompleteAll=function(){console.info("onCompleteAll"),a.getLabel()};var j=a.catalogUploader=new g({url:"http://localhost:3000/labels/"+h+"/dropzone/",headers:{Authorization:"Bearer "+c.getToken()}});j.onWhenAddingFileFailed=function(a,b,c){console.info("onWhenAddingFileFailed",a,b,c)},j.onAfterAddingFile=function(a){console.info("onAfterAddingFile",a)},j.onAfterAddingAll=function(a){console.info("onAfterAddingAll",a)},j.onBeforeUploadItem=function(a){console.info("onBeforeUploadItem",a)},j.onProgressItem=function(a,b){console.info("onProgressItem",a,b)},j.onProgressAll=function(a){console.info("onProgressAll",a)},j.onSuccessItem=function(a,b,c,d){console.info("onSuccessItem",a,b,c,d)},j.onErrorItem=function(a,b,c,d){console.info("onErrorItem",a,b,c,d)},j.onCancelItem=function(a,b,c,d){console.info("onCancelItem",a,b,c,d)},j.onCompleteItem=function(a,b,c,d){console.info("onCompleteItem",a,b,c,d)},j.onCompleteAll=function(){console.info("onCompleteAll"),j.clearQueue()},a.getLabel=function(){e.get("http://localhost:3000/labels/"+h).success(function(b){a.label=b})},a.getDropZoneFiles=function(){e.get("http://localhost:3000/labels/"+h+"/dropZoneFiles").success(function(b){a.dropZoneFiles=b})},a.getDropZoneFiles(),a.getLabel()}]),angular.module("tracklistmeApp").controller("AdmincompanyCtrl",["$scope","$state","$auth","$stateParams","$http","Account","FileUploader",function(a,b,c,d,e,f,g){var h=d.id,i=4,j=3;a.isSearching=!1,a.nameAvailable=!1,a.nameTooShort=!0,a.searchUserResults=null,a.currentLabel=null,a.labelList={};var k=a.uploader=new g({url:"http://localhost:3000/companies/"+h+"/profilePicture/500/500/",headers:{Authorization:"Bearer "+c.getToken()},data:{user:a.user}});k.onAfterAddingFile=function(a){console.info("onAfterAddingFile",a),k.queue[0].upload(),k.queue.pop()},k.onCompleteAll=function(){console.info("onCompleteAll"),a.getCompany()},a.addLabel=function(){console.log("ADD Label"),e.post("http://localhost:3000/labels/",{companyId:h,labelName:a.seachLabelField}).success(function(){a.updateLabelList()}).error(function(){})},a.searchLabelAvailability=function(){a.seachLabelField.length>i?(a.isSearching=!0,a.nameTooShort=!1,e.get("http://localhost:3000/labels/search/"+a.seachLabelField).success(function(b){a.isSearching=!1,a.nameAvailable=b?!1:!0})):a.nameTooShort=!0},a.addLabelManager=function(){var b=a.searchUserResults[0].id,c=a.currentLabel.id;e.post("http://localhost:3000/labels/"+c+"/labelManagers/",{newLabelManager:b}).success(function(){a.editLabel(c)}).error(function(){})},a.removeLabelManager=function(b){var c=a.currentLabel.id;e["delete"]("http://localhost:3000/labels/"+c+"/labelManagers/"+b).success(function(){a.editLabel(c)}).error(function(){})},a.selectFromMultipleUsers=function(b){a.searchUserResults=[b],console.log(a.searchUserResults)},a.searchUser=function(){a.searchUserField.length>j&&e.get("http://localhost:3000/users/search/"+a.searchUserField).success(function(b){a.searchUserResults=b,console.log(a.searchUserResults)})},a.updateLabelList=function(){e.get("http://localhost:3000/companies/"+h+"/labels").success(function(b){console.log(b),a.labelList=b})},a.editLabel=function(b){e.get("http://localhost:3000/labels/"+b).success(function(b){console.log(b),a.currentLabel=b})},a.getCompany=function(){e.get("http://localhost:3000/companies/"+h).success(function(b){a.company=b})},a.updateLabelList(),a.getCompany()}]),angular.module("tracklistmeApp").filter("bytes",function(){var a=["bytes","KB","MB","GB","TB","PB"];return function(b,c){if(isNaN(parseFloat(b))||!isFinite(b))return"?";for(var d=0;b>=1024;)b/=1024,d++;return b.toFixed(+c)+" "+a[d]}});